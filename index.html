
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pedro Jiménez's Blog</title>
  <meta name="author" content="Pedro Jiménez Solís">

  
  <meta name="description" content="<img align=center
src="http://topjailbreakapps.info/wp-content/uploads/2010/02/SSH1.jpg"> Problemática Nos hemos mudado a una nueva oficina y &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pedrojimenez.github.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Pedro Jiménez's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pedro Jiménez's Blog</a></h1>
  
    <h2>Un blog de muchas inquietudes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pedrojimenez.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/07/ono-netgear-router-losing-ssh-conections/">ONO Netgear Router: Losing SSH Conections</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-07T10:53:00+01:00" pubdate data-updated="true">Feb 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/07/ono-netgear-router-losing-ssh-conections/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><center>
<img align=center
src="http://topjailbreakapps.info/wp-content/uploads/2010/02/SSH1.jpg">
</center>




<h2>Problemática</h2>


<p>Nos hemos mudado a una nueva oficina y tenemos la suerte de haber contratado
ONO 100 MB. La verdad que como línea de comunicaciones es excepcional. Pero
mientras trabajamos nos hemos encontrado con un problemilla de comunicaciones a
la hora de mantener las sesiones SSH activas.</p>

<p>Como casi todas las empresas TIC, nosotros tenenos servidores externos para
varios usos. El caso es que el equipo de Sistemas suele tener varias &#8220;consolas&#8221;
abiertas con múltiples conexiones <strong>SSH</strong>.</p>

<p>Antes de tener contratado <strong>ONO</strong> la verdad que no se nos cortaba la conexión
de dichas sesiones, pero ahora mismo no podemos dejarlas sin actividad más de
unos pocos minutos. Para poder mantener las sesiones abiertas deberemos
realizar algunos cambios o bien en la parte del Server o bien en la parte de
Cliente.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/02/07/ono-netgear-router-losing-ssh-conections/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/06/appendix-chef-client-log-configuration-after-bootstrap/">Appendix: Chef-client Log Configuration After Bootstrap</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-06T11:19:00+01:00" pubdate data-updated="true">Feb 6<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/06/appendix-chef-client-log-configuration-after-bootstrap/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><center>
<img align=center
src="http://docs.opscode.com/_static/opscode_chef_html_logo.jpg">
</center>


<br />




<h2>Chef: Logs después de realizar un BootStrap</h2>


<p>Ya hemos visto en post anteriores como realizar la instalación de OpenStack
bien con un servidor de [Chef Hosted] bien con un servidor [Chef Privado].
También se realizó un post sobre la instalación de un Servidor de Chef Privado
a través de una gema de Ruby
<a href="http://pedrojimenez.github.com/blog/2013/01/29/installing-a-private-chef-server-via-knife-server/">knife-server</a>.</p>

<p>Bien, a la hora de depurar errores en cada ejecución del cliente de Chef la
salida está configurada por defecto para que lo haga en <strong>STDOUT</strong>. Sin embargo
en las instalaciones por paquetería de <strong>chef-client</strong> esta configuración se
sobreescribe con el valor que se especifique en <strong>/etc/default/chef-client</strong>,
que en nuestro caso será <strong>/var/log/chef/chef-client.log</strong>.</p>

<p>Valores por paquetería de /etc/chef/clint.rb</p>

<pre>
log_level          :info
log_location       STDOUT
</pre>


<p>Valores por paquetería de /etc/default/chef-client</p>

<pre>
LOGFILE=/var/log/chef/client.log
CONFIG=/etc/chef/client.rb
INTERVAL=1800
SPLAY=20
</pre>




</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/02/06/appendix-chef-client-log-configuration-after-bootstrap/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/31/openstack-installation-librarian-and-spiceweasel-part-ii-private-chef-server/">Openstack Installation - Librarian and Spiceweasel Part II - Private Chef Server</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-31T11:02:00+01:00" pubdate data-updated="true">Jan 31<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/01/31/openstack-installation-librarian-and-spiceweasel-part-ii-private-chef-server/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><center>
<img align=center
src="http://docs.opscode.com/_static/opscode_chef_html_logo.jpg">
</center>


<br />


<h2>Eligiendo Servidor</h2>


<p>Como ya vimos en el post previo a este, hay una manera muy sencilla de instalar
un servidor de Chef mediante una Gema de Ruby, knife-server.</p>

<p>Ver: <a href="http://pedrojimenez.github.com/blog/2013/01/29/installing-a-private-chef-server-via-knife-server">http://pedrojimenez.github.com/blog/2013/01/29/installing-a-private-chef-server-via-knife-server</a></p>

<p>Nuestro objetivo real ahora mismo es realizar el despliegue de <strong>OpenStack</strong>, por
tanto cada cual deberá decidir cómo quiere instalarse el servidor propio de
Chef. Si es necesaria más información, se puede revisar la documentación
oficial de la gente de OpsCode.</p>

<p>Instalación: <a href="http://private-chef-docs.opscode.com/installation.html">http://private-chef-docs.opscode.com/installation.html</a></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/01/31/openstack-installation-librarian-and-spiceweasel-part-ii-private-chef-server/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/29/installing-a-private-chef-server-via-knife-server/">Installing a Private Chef Server via Knife-server</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-29T09:45:00+01:00" pubdate data-updated="true">Jan 29<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/29/installing-a-private-chef-server-via-knife-server/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><center>
<img align=center
src="http://docs.opscode.com/_static/opscode_chef_html_logo.jpg">
</center>


<p>Existen varias maneras de instalar un servidor de Chef privado, bien sea en una
máquina virtual o física. Vamos a abordar una de ellas, la instalación del
servidor de Chef via la gema de &#8220;knife-server&#8221;.</p>

<p>Más información sobre instalaciones manuales de CHEF:
<a href="http://wiki.opscode.com/display/chef/Installing+Chef+Server+Manually">http://wiki.opscode.com/display/chef/Installing+Chef+Server+Manually</a></p>

<p>Será necesario tener un entorno RVM operativo y funcional. Para más información
se puede ampliar desde aquí: <a href="https://rvm.io/rvm/install/">https://rvm.io/rvm/install/</a>. La verdad que no es
el objetivo de este post explicar la instalación de dicho entorno.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/01/29/installing-a-private-chef-server-via-knife-server/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/28/openstack-installation-librarian-and-spiceweasel-part-i-hosted-chef/">Openstack Installation - Librarian and Spiceweasel Part I - Hosted Chef</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-28T12:58:00+01:00" pubdate data-updated="true">Jan 28<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/28/openstack-installation-librarian-and-spiceweasel-part-i-hosted-chef/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><center>
<img align=center
src="http://docs.opscode.com/_static/opscode_chef_html_logo.jpg">
</center>




<h2>¿ Quiénes son ?</h2>


<p>Hemos de detenernos un instante para hacer meción especial a las 2 maravillosas
gemas que nos harán la vida muy sencilla con OpenStack. Hablamos de &#8220;librarian&#8221;
y de &#8220;spiceweasel&#8221;. Para que la presentación sea bastante más oficial debemos
considerar que librarian será nuestro &#8220;cazador de cookbooks&#8221; y que spiceweasel
será el que los aplique contra el Servidor de Chef que elijamos, bien sea
público o privado. Además SpiceWeasel se encargará de aplicar roles/cookbooks a
los nodos directamente. Con esta pequeña &#8220;joya&#8221; se pueden hacer despliegues
verdaderamente veloces.</p>

<p><strong>Librarian</strong></p>

<p>Librarian-Chef is a bundler for infrastructure repositories using Chef. You can
use Librarian-Chef to resolve your infrastructure&#8217;s cookbook dependencies,
fetch them, and install them into your infrastructure repository.</p>

<p>Enlace: <a href="https://github.com/applicationsonline/librarian">https://github.com/applicationsonline/librarian</a></p>

<p><strong>SpiceWeasel</strong></p>

<p>Provides a CLI tool for generating knife commands to build Chef-managed
infrastructure from a simple JSON or YAML file.</p>

<p>Enlace: <a href="http://wiki.opscode.com/display/chef/Spiceweasel">http://wiki.opscode.com/display/chef/Spiceweasel</a></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/01/28/openstack-installation-librarian-and-spiceweasel-part-i-hosted-chef/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/12/ubuntu-python-keystoneclient-dependency-error/">Ubuntu Python-keystoneclient Dependency Error</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-12T12:59:00+01:00" pubdate data-updated="true">Dec 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/12/12/ubuntu-python-keystoneclient-dependency-error/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Después de tener la infraestructura completa y funcional, nos encontramos ayer con un extraño error que no nos permitía el uso de Glance para poder hacer un &#8220;upload&#8221; de las imágenes. Nos encontramos con un error de dependencias en uno de los paquetes necesarios en la invocación de Glance.</p>

<p>Buscando algo más de información vemos que con la paquetería actual se llega a un error de versionado en el paquete <strong>python-keystoneclient</strong> y no permite que glance se ejecute.</p>

<pre>
root@controller:~# glance index
Traceback (most recent call last):
File "/usr/bin/glance", line 5, in <module>
from pkg_resources import load_entry_point
File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 2711, in <module>
parse_requirements(__requires__), Environment()
 File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 584, in resolve
raise DistributionNotFound(req)
pkg_resources.DistributionNotFound: python-keystoneclient>=0.1.2,<0.2
          
root@controller:~# glance image-list
Traceback (most recent call last):
File "/usr/bin/glance", line 5, in <module>
from pkg_resources import load_entry_point
File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 2711, in <module>
parse_requirements(__requires__), Environment()
File "/usr/lib/python2.7/dist-packages/pkg_resources.py", line 584, in resolve
raise DistributionNotFound(req)
pkg_resources.DistributionNotFound: python-keystoneclient>=0.1.2,<0.2
</pre>




</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/12/12/ubuntu-python-keystoneclient-dependency-error/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/11/chef-bootstrapping-for-first-time/">Chef: Bootstrapping for First Time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-11T15:36:00+01:00" pubdate data-updated="true">Dec 11<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/12/11/chef-bootstrapping-for-first-time/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><center>
<img align=center src="http://docs.opscode.com/_static/opscode_chef_html_logo.jpg">
</center>


<p>Hemos arrancado por fin nuestro laboratorio completamente con Chef y nos tocaba probar uno de los trucos/habilidades más asombrosas de Knife, BooTstrap.</p>

<p>Gracias a este comando podremos incluir a un nodo que no estuviera dado de alta en nuestra infraestructura desde alguno de los nodos de &#8220;administración&#8221;, completando su registro e instalando el software de Chef en dicho nodo. Además crea el fichero de configuración &#8220;client.rb&#8221; y los dos ficheros de claves, el de cliente (client.pem) y el del servidor (validation.pem) en el nodo.</p>

<pre>
[ coruscant:~ ] knife bootstrap 192.168.1.242 -x operador -P onetimepassword --sudo
Bootstrapping Chef on 192.168.1.242
192.168.1.242 [Tue, 11 Dec 2012 15:14:48 +0100] INFO: *** Chef 10.14.4 ***
192.168.1.242 [Tue, 11 Dec 2012 15:14:49 +0100] INFO: Client key /etc/chef/client.pem is not present - registering
192.168.1.242 [Tue, 11 Dec 2012 15:14:49 +0100] INFO: HTTP Request Returned 404 Not Found: Cannot load node compute02
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Setting the run_list to [] from JSON
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Run List is []
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Run List expands to []
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Starting Chef Run for compute02
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Running start handlers
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Start handlers complete.
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Loading cookbooks []
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] WARN: Node compute02 has an empty run list.
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Chef Run complete in 0.632681 seconds
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Running report handlers
192.168.1.242 [Tue, 11 Dec 2012 15:14:50 +0100] INFO: Report handlers complete
</pre>




</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/12/11/chef-bootstrapping-for-first-time/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/05/cinder-volume-creation-error-in-folsom/">Cinder: Volume Creation Error in Folsom</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-05T17:45:00+01:00" pubdate data-updated="true">Dec 5<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/12/05/cinder-volume-creation-error-in-folsom/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><center> 
    <img src="http://wiki.openstack.org/Icons?action=AttachFile&do=get&target=openstack-object-storage-icon.png" alt="Cinder">
    <img src="http://wiki.openstack.org/Icons?action=AttachFile&do=get&target=openstack-object-storage-icon.png" alt="Cinder">
    <img src="http://wiki.openstack.org/Icons?action=AttachFile&do=get&target=openstack-object-storage-icon.png" alt="Cinder">
</center>


<br /><br />


<p>Estamos inmersos en la automatización de las instalaciones de Openstack con Chef. Utilizamos actualmente una infraestructura muy sencilla con un Chef-Server local que vamos utilizando para diferentes clientes/laboratorios.</p>

<p>Una de las varias modificaciones que hemos tenido que realizar ha sido con el cookbook de Cinder. Nos hemos encontrado que después de tocar atributos en el &#8220;Rol&#8221; y el &#8220;Entorno&#8221; nos seguía dando error al crear el volumen desde consola. Más específicamente un error de iSCSI:</p>

<pre>
2012-12-05 17:01:19 4046 ERROR cinder.openstack.common.rpc.amqp [-] Exception during message handling
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp Traceback (most recent call last):
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp   File "/usr/lib/python2.7/dist-packages/cinder/openstack/common/rpc/amqp.py", line 276, in _process_data
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp   File "/usr/lib/python2.7/dist-packages/cinder/openstack/common/rpc/dispatcher.py", line 145, in dispatch
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp   File "/usr/lib/python2.7/dist-packages/cinder/volume/manager.py", line 163, in create_volume
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp     volume_ref['id'], {'status': 'error'})
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp   File "/usr/lib/python2.7/contextlib.py", line 24, in __exit__
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp     self.gen.next()
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp   File "/usr/lib/python2.7/dist-packages/cinder/volume/manager.py", line 156, in create_volume
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp     model_update = self.driver.create_export(context, volume_ref)
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp   File "/usr/lib/python2.7/dist-packages/cinder/volume/driver.py", line 437, in create_export
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp     volume_path)
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp   File "/usr/lib/python2.7/dist-packages/cinder/volume/iscsi.py", line 145, in create_iscsi_target
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp     raise exception.ISCSITargetCreateFailed(volume_id=vol_id)
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp ISCSITargetCreateFailed: Failed to create iscsi target for volume volume-4e680c7b-b8f4-43b8-a766-1996a2537474.
2012-12-05 17:01:19 4046 TRACE cinder.openstack.common.rpc.amqp 
</pre>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/12/05/cinder-volume-creation-error-in-folsom/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/16/database-access-error-in-folsom/">Database Access Error in Folsom</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-16T11:32:00+01:00" pubdate data-updated="true">Nov 16<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/16/database-access-error-in-folsom/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Después de darle muchas vueltas al asunto, el comodín que se utilizaba en Mysql 5.1 (versión usada Diablo and Essex) el conocido &#8220;%&#8221; ha comenzado a fallar. Nos encontramos con errores de acceso a las Bases de Datos que eran nuevos para mi hasta el momento. Revisando las bitácoras de instalaciones previas hemos visto que los permisos de acceso a las diferentes DataBases de Mysql han cambiado y se utiliza como única línea de permisos la siguiente:</p>

<pre>
mysql_database_user[keystone]: granting access with statement [GRANT all ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'onetimepassword']
</pre>


<p>Pero solamente con esta sentencia constatamos que el acceso desde otros nodos (multihost) nos daba error. Para solucionar estos problemas se ha probado a añadir sentencias extras de &#8220;GRANT&#8221; hasta que permitió dichas conexiones. Haciendo un resumen de todas ellas se ha modificado el cookbook de osops-utils para que añada una nueva sentencia de GRANT contra la dirección en la que se bindea el servicio de Mysql. De esta manera se podrá configurar el servicio de Base de Datos en HA y tener los accesos contra la &#8220;bind_address&#8221;.</p>

<pre>
Archivo "osops-utils/libraries/database.rb"

        mysql_database_user username do
          connection connection_info
          password pw
          database_name db_name
          host "#{mysql_info["bind_address"]}"
          privileges [:all]
          action :grant
        end
</pre>


<p>Se ha hecho un <em>Pull Request</em> a la gente de <em>Rcbops</em> con esta modificación.<a href="https://github.com/rcbops-cookbooks/osops-utils/pull/46#issuecomment-10194833">Enlace</a>.</p>

<p>Ahora mismo lo estoy usando en nuestro Chef Server en el despligue de Folsom y funciona &#8220;like a charm&#8221;. Nos genera dos sentencias de permisos para cada servicio (keystone/glance/nova/horizon).</p>

<pre>
INFO: Processing mysql_database_user[keystone] action grant (keystone::server line 24)
INFO: mysql_database_user[keystone]: granting access with statement [GRANT all ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'onetimepassword']
INFO: Processing mysql_database_user[keystone] action grant (keystone::server line 32)
INFO: mysql_database_user[keystone]: granting access with statement [GRANT all ON keystone.* TO 'keystone'@'172.16.172.4' IDENTIFIED BY 'onetimepassword']
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/15/keystone-user-role-list-bug/">Keystone User-role-list Bug</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-15T15:02:00+01:00" pubdate data-updated="true">Nov 15<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/15/keystone-user-role-list-bug/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Depurando el comportamiento de Keystone para solventar un error que me trae de cabeza en Glance, he visto que un nuevos comandos que se han añadido al servicio de Identidad en OpenStack (&#8220;keystone user-role-list&#8221;). Este comando nos permitirá extraer un listado de los usuarios/roles/tenants de un solo vistazo.</p>

<p>Problema: que ahora mismo no funciona como se espera. Tan solo muestra el listado de los roles que hay para el usurio que tenemos en las variables de entorno (cargadas en el fichero novarc o como queramos llamarlo). Necesitaba conocer dicho listado del usuario &#8220;glance&#8221; no del usuario &#8220;admin&#8221;. En una primera pasada vemos que el listado solamente nos permite obtener los del mismo usuario &#8220;admin&#8221;:</p>

<pre>
keystone role-list
+----------------------------------+----------------------+
|                id                |         name         |
+----------------------------------+----------------------+
| 06bc817f9b8647d3bb795c6a1107cff3 |    KeystoneAdmin     |
| 1e77a4036d42446aabcfc706759b732d | KeystoneServiceAdmin |
| 25fcba9f9b9a4982a77f70fd2c84fc31 |        admin         |
| 28941e6016ea488cad9e5e55fee7d8aa |        Member        |
+----------------------------------+----------------------+

keystone tenant-list
+----------------------------------+---------+---------+
|                id                |   name  | enabled |
+----------------------------------+---------+---------+
| 15eafea37ce24b42ab60b1fe0f882d98 | service |   true  |
| 18e181671f174cc1bce64e4370eea96a |  admin  |   true  |
+----------------------------------+---------+---------+

keystone user-list
+----------------------------------+------------+---------+-------+
|                id                |    name    | enabled | email |
+----------------------------------+------------+---------+-------+
| 4be33d2e90ad42ce867954b07aa7b908 |   admin    |   true  |       |
| 8c53cdc1f4354e77a8e2abd39728b20d |    nova    |   true  |       |
| bd9e78ff6ca84c7181f3f412a01597ed | monitoring |   true  |       |
| f6b72f21414246d0a924fc883e694f45 |   glance   |   true  |       |
+----------------------------------+------------+---------+-------+

keystone user-role-list
+----------------------------------+----------------------+----------------------------------+----------------------------------+
|                id                |         name         |             user_id              |            tenant_id             |
+----------------------------------+----------------------+----------------------------------+----------------------------------+
| 06bc817f9b8647d3bb795c6a1107cff3 |    KeystoneAdmin     | 4be33d2e90ad42ce867954b07aa7b908 | 18e181671f174cc1bce64e4370eea96a |
| 1e77a4036d42446aabcfc706759b732d | KeystoneServiceAdmin | 4be33d2e90ad42ce867954b07aa7b908 | 18e181671f174cc1bce64e4370eea96a |
| 25fcba9f9b9a4982a77f70fd2c84fc31 |        admin         | 4be33d2e90ad42ce867954b07aa7b908 | 18e181671f174cc1bce64e4370eea96a |
+----------------------------------+----------------------+----------------------------------+----------------------------------+
</pre>




</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/11/15/keystone-user-role-list-bug/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/02/07/ono-netgear-router-losing-ssh-conections/">ONO Netgear Router: Losing SSH conections</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/06/appendix-chef-client-log-configuration-after-bootstrap/">Appendix: Chef-client log configuration after Bootstrap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/31/openstack-installation-librarian-and-spiceweasel-part-ii-private-chef-server/">Openstack Installation - librarian and spiceweasel  Part II - Private Chef Server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/29/installing-a-private-chef-server-via-knife-server/">Installing a Private Chef Server via knife-server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/28/openstack-installation-librarian-and-spiceweasel-part-i-hosted-chef/">Openstack Installation - librarian and spiceweasel  Part I - Hosted Chef</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pedrojimenez">@pedrojimenez</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pedrojimenez',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("pjimenezsolis", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/pjimenezsolis" class="twitter-follow-button" data-show-count="false">Follow @pjimenezsolis</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Pedro Jiménez Solís -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'myblog-pedrojimenez';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
